<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>添加Jackson Mixin解决redis序列化失败问题 | 云逸的知识库</title>
    <meta name="description" content="个人技术知识库，记录和分享个人碎片化、结构化、体系化的技术知识内容">
    <meta name="generator" content="VitePress v1.1.4">
    <link rel="preload stylesheet" href="/assets/style.pCaHnWZu.css" as="style">
    
    <script type="module" src="/assets/app.D-N1sCaq.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.DGhdORX1.js">
    <link rel="modulepreload" href="/assets/chunks/theme.C7H76Bwr.js">
    <link rel="modulepreload" href="/assets/chunks/katex-ffb0e8f1.xpx6yKzS.js">
    <link rel="modulepreload" href="/assets/chunks/c4Diagram-e2511a7a.BeYfI28Y.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-e44a2353.CVgjLZgB.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-v2-a8396bb5.Dyg2sl1l.js">
    <link rel="modulepreload" href="/assets/chunks/erDiagram-582bd92f.BVmqCITn.js">
    <link rel="modulepreload" href="/assets/chunks/gitGraphDiagram-d5d647e9.DBGievCq.js">
    <link rel="modulepreload" href="/assets/chunks/ganttDiagram-05e48839.BWW36Htb.js">
    <link rel="modulepreload" href="/assets/chunks/infoDiagram-00deb277.BgqqP1d7.js">
    <link rel="modulepreload" href="/assets/chunks/pieDiagram-35c7eafc.DDAQrYyX.js">
    <link rel="modulepreload" href="/assets/chunks/quadrantDiagram-9c93c009.Dv-Yp9zF.js">
    <link rel="modulepreload" href="/assets/chunks/xychartDiagram-7b46ecfd.BtRfe_UM.js">
    <link rel="modulepreload" href="/assets/chunks/requirementDiagram-e882bd67.CzeNAERw.js">
    <link rel="modulepreload" href="/assets/chunks/sequenceDiagram-1767341c.C1hwsnyl.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-3275847a.BuzMvcXR.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-v2-2ed0a7d3.CL1ZcBud.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-d2e6f24f.DiZ-K_zk.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-v2-21d485ae.CvM-KFZe.js">
    <link rel="modulepreload" href="/assets/chunks/journeyDiagram-a5efd2e1.BSFuB01C.js">
    <link rel="modulepreload" href="/assets/chunks/flowchart-elk-definition-1a3aaf5d.8mDLKORw.js">
    <link rel="modulepreload" href="/assets/chunks/timeline-definition-f8c5dfc0.CoymNc-h.js">
    <link rel="modulepreload" href="/assets/chunks/mindmap-definition-74120bdd.BuEDPwLq.js">
    <link rel="modulepreload" href="/assets/chunks/sankeyDiagram-f5d051b7.D-XVi6Lq.js">
    <link rel="modulepreload" href="/assets/chunks/blockDiagram-8beecd1f.AwlZ6TWF.js">
    <link rel="modulepreload" href="/assets/chunks/virtual_mermaid-config.DDnGl6nM.js">
    <link rel="modulepreload" href="/assets/chunks/ArticleMetadata.DArXzXOG.js">
    <link rel="modulepreload" href="/assets/authorization-server_02-优化篇_03-add-Jackson-Mixin.md.42dt8lo3.lean.js">
    <link rel="icon" href="/favicon.ico">
    <meta name="author" content="Charles7c">
    <meta name="keywords" content="查尔斯的知识库, 知识库, 博客, Charles7c">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="theme-color" content="#3c8772">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:title" content="云逸的知识库">
    <meta property="og:description" content="个人技术知识库，记录和分享个人碎片化、结构化、体系化的技术知识内容">
    <meta property="og:site" content="https://vains-sofia.gitee.io">
    <meta property="og:site_name" content="云逸的知识库">
    <meta property="og:image" content="https://vains-sofia.gitee.io/logo.jpg">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-654777d8><!--[--><!--]--><!--[--><span tabindex="-1" data-v-35de2ca8></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-35de2ca8> Skip to content </a><!--]--><!----><header class="VPNav" data-v-654777d8 data-v-43e376a4><div class="VPNavBar has-sidebar top" data-v-43e376a4 data-v-9791a0f2><div class="wrapper" data-v-9791a0f2><div class="container" data-v-9791a0f2><div class="title" data-v-9791a0f2><div class="VPNavBarTitle has-sidebar" data-v-9791a0f2 data-v-5a7a6776><a class="title" href="/" data-v-5a7a6776><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.png" alt data-v-0bbaa066><!--]--><span data-v-5a7a6776>云逸的知识库</span><!--[--><!--]--></a></div></div><div class="content" data-v-9791a0f2><div class="content-body" data-v-9791a0f2><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9791a0f2><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9791a0f2 data-v-587b0e42><span id="main-nav-aria-label" class="visually-hidden" data-v-587b0e42>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/01-what-is-Spring-OAuth2-Authorization-Server" tabindex="0" data-v-587b0e42 data-v-50f19583><!--[--><span data-v-50f19583>Spring OAuth2 Authorization Server</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/tags" tabindex="0" data-v-587b0e42 data-v-50f19583><!--[--><span data-v-50f19583>我的标签</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/archives" tabindex="0" data-v-587b0e42 data-v-50f19583><!--[--><span data-v-50f19583>我的归档</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9791a0f2 data-v-739278fe><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-739278fe data-v-ce69ce15 data-v-edbcc6c0><span class="check" data-v-edbcc6c0><span class="icon" data-v-edbcc6c0><!--[--><span class="vpi-sun sun" data-v-ce69ce15></span><span class="vpi-moon moon" data-v-ce69ce15></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9791a0f2 data-v-c2b8a29d data-v-c279aa26><!--[--><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9791a0f2 data-v-8370ed8b data-v-49c23037><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-49c23037><span class="vpi-more-horizontal icon" data-v-49c23037></span></button><div class="menu" data-v-49c23037><div class="VPMenu" data-v-49c23037 data-v-c8414c67><!----><!--[--><!--[--><!----><div class="group" data-v-8370ed8b><div class="item appearance" data-v-8370ed8b><p class="label" data-v-8370ed8b>切换日光/暗黑模式</p><div class="appearance-action" data-v-8370ed8b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-8370ed8b data-v-ce69ce15 data-v-edbcc6c0><span class="check" data-v-edbcc6c0><span class="icon" data-v-edbcc6c0><!--[--><span class="vpi-sun sun" data-v-ce69ce15></span><span class="vpi-moon moon" data-v-ce69ce15></span><!--]--></span></span></button></div></div></div><div class="group" data-v-8370ed8b><div class="item social-links" data-v-8370ed8b><div class="VPSocialLinks social-links-list" data-v-8370ed8b data-v-c279aa26><!--[--><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9791a0f2 data-v-a275a8ec><span class="container" data-v-a275a8ec><span class="top" data-v-a275a8ec></span><span class="middle" data-v-a275a8ec></span><span class="bottom" data-v-a275a8ec></span></span></button></div></div></div></div><div class="divider" data-v-9791a0f2><div class="divider-line" data-v-9791a0f2></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-654777d8 data-v-80853cd5><div class="container" data-v-80853cd5><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-80853cd5><span class="vpi-align-left menu-icon" data-v-80853cd5></span><span class="menu-text" data-v-80853cd5>文章</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-80853cd5 data-v-33ddb4b9><button data-v-33ddb4b9>返回顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-654777d8 data-v-73e27b6b><div class="curtain" data-v-73e27b6b></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-73e27b6b><span class="visually-hidden" id="sidebar-aria-label" data-v-73e27b6b> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-73e27b6b><section class="VPSidebarItem level-0 collapsible" data-v-73e27b6b data-v-3a5dabe3><div class="item" role="button" tabindex="0" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><h2 class="text" data-v-3a5dabe3>基础集成 (6篇)</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3a5dabe3><span class="vpi-chevron-right caret-icon" data-v-3a5dabe3></span></div></div><div class="items" data-v-3a5dabe3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/01-what-is-Spring-OAuth2-Authorization-Server" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>什么是Spring OAuth2 Authorization Server</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/02-Spring-Boot-sample-integration" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-orange mr-[6px]" style="font-weight: 550; display: inline-block;">2</div>简单集成</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/03-custom-exception-catch" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-yellow mr-[6px]" style="font-weight: 550; display: inline-block;">3</div>自定义异常响应处理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/04-login-add-captcha" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">4</div>登录页面添加图片验证码</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/05-login-add-sms-login-type" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">5</div>扩展登录-添加短信登录</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/06-FAQ" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">6</div>常见问题解答(FAQ)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-73e27b6b><section class="VPSidebarItem level-0 collapsible" data-v-73e27b6b data-v-3a5dabe3><div class="item" role="button" tabindex="0" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><h2 class="text" data-v-3a5dabe3>优化篇 (3篇)</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3a5dabe3><span class="vpi-chevron-right caret-icon" data-v-3a5dabe3></span></div></div><div class="items" data-v-3a5dabe3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/02-%E4%BC%98%E5%8C%96%E7%AF%87/01-add-redis-support-common-result" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>添加redis支持和统一响应处理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/02-%E4%BC%98%E5%8C%96%E7%AF%87/02-custom-UserDetailsService" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-orange mr-[6px]" style="font-weight: 550; display: inline-block;">2</div>自定义UserDetails实现从数据库获取用户信息</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/02-%E4%BC%98%E5%8C%96%E7%AF%87/03-add-Jackson-Mixin" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-yellow mr-[6px]" style="font-weight: 550; display: inline-block;">3</div>添加Jackson Mixin解决redis序列化失败问题</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-73e27b6b><section class="VPSidebarItem level-0 collapsible" data-v-73e27b6b data-v-3a5dabe3><div class="item" role="button" tabindex="0" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><h2 class="text" data-v-3a5dabe3>自定义grant type (2篇)</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3a5dabe3><span class="vpi-chevron-right caret-icon" data-v-3a5dabe3></span></div></div><div class="items" data-v-3a5dabe3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/03-%E8%87%AA%E5%AE%9A%E4%B9%89grant%20type/01-device-code-flow" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>集成设备码授权</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/03-%E8%87%AA%E5%AE%9A%E4%B9%89grant%20type/02-custom-grant-type-sms-captcha-get-access-token" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-orange mr-[6px]" style="font-weight: 550; display: inline-block;">2</div>扩展grant type(短信登录)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-73e27b6b><section class="VPSidebarItem level-0 collapsible collapsed" data-v-73e27b6b data-v-3a5dabe3><div class="item" role="button" tabindex="0" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><h2 class="text" data-v-3a5dabe3>进阶教程 (10篇)</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3a5dabe3><span class="vpi-chevron-right caret-icon" data-v-3a5dabe3></span></div></div><div class="items" data-v-3a5dabe3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/01-custom-token-payload" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>扩展grant type(短信登录)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/02-oauth2-client-integration-server-provider" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-orange mr-[6px]" style="font-weight: 550; display: inline-block;">2</div>OAuth2客户端对接认证服务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/03-resource-server-integration-server-provider" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-yellow mr-[6px]" style="font-weight: 550; display: inline-block;">3</div>资源服务对接认证服务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/04-vue-integration-server-provider-with-authorization-code" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">4</div>Vue通过授权码对接认证服务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/05-vue-integration-server-provider-with-pkce" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">5</div>Vue通过PKCE对接认证服务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/06-gateway-integration-server-provider" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">6</div>网关对接认证服务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/07-split-login-page" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">7</div>前后端分离-登录页面</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/08-split-consent-device-validation-page" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">8</div>前后端分离-授权确认和设备码</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/09-implement-core-services-with-redis" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">9</div>基于redis的核心服务实现</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/10-qr-code-login" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">10</div>扫码登录实现</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-73e27b6b><section class="VPSidebarItem level-0 collapsible collapsed" data-v-73e27b6b data-v-3a5dabe3><div class="item" role="button" tabindex="0" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><h2 class="text" data-v-3a5dabe3>联合身份认证 (2篇)</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3a5dabe3><span class="vpi-chevron-right caret-icon" data-v-3a5dabe3></span></div></div><div class="items" data-v-3a5dabe3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/05-%E8%81%94%E5%90%88%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/01-github-gitee-federation" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>联合身份认证-gitee、github</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/05-%E8%81%94%E5%90%88%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/02-wechat-federation" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-orange mr-[6px]" style="font-weight: 550; display: inline-block;">2</div>联合身份认证-微信登录</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-654777d8 data-v-748affb0><div class="VPDoc has-sidebar has-aside" data-v-748affb0 data-v-dc58f89e><!--[--><!--]--><div class="container" data-v-dc58f89e><div class="aside" data-v-dc58f89e><div class="aside-curtain" data-v-dc58f89e></div><div class="aside-container" data-v-dc58f89e><div class="aside-content" data-v-dc58f89e><div class="VPDocAside" data-v-dc58f89e data-v-aa7136e9><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" role="navigation" data-v-aa7136e9 data-v-5519f07f><div class="content" data-v-5519f07f><div class="outline-marker" data-v-5519f07f></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-5519f07f>目录</div><ul class="VPDocOutlineItem root" data-v-5519f07f data-v-db339dd9><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-aa7136e9></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-dc58f89e><div class="content-container" data-v-dc58f89e><!--[--><!--]--><main class="main" data-v-dc58f89e><div style="position:relative;" class="vp-doc _authorization-server_02-%E4%BC%98%E5%8C%96%E7%AF%87_03-add-Jackson-Mixin" data-v-dc58f89e><div><h1 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-label="Permalink to &quot;前言&quot;">​</a></h1><!----><p>    在<a href="https://juejin.cn/post/7254096495184134181" target="_blank" rel="noreferrer">授权码模式的前后端分离</a>的那篇文章中使用了Redis来保存用户的认证信息，在Redis的配置文件中配置的值序列化器是默认的Jdk序列化器，虽然这样也可以使用，但是在Redis客户端中查看时是乱码的(看起来是)，如果切换为Jackson提供的值序列化器时又会在反序列化时失败，这样是不符合实际的，在项目框架搭建完毕或在已有项目中这些配置实际上应该都已经配置好了的，不能说为了这么一个功能去改原有配置，<strong>所以这里要跟大家说一声对不起，因为在下学艺不精而导致这么一个大缺陷一直留到了现在</strong>。</p><h1 id="问题分析" tabindex="-1">问题分析 <a class="header-anchor" href="#问题分析" aria-label="Permalink to &quot;问题分析&quot;">​</a></h1><!----><p>    当时用到的地方就是在登录成功和初始化<code>SecurityContextHolderFilter</code>中初始化认证信息的地方存、取<code>SecurityContext</code>(认证信息)，存的时候倒是没有问题，但是取的时候就会因为框架内的类不提供默认的构造器从而造成反序列化失败的问题，或者是类型转换异常</p><p>    Jackson 只能识别java基本类型，遇到复杂类型时，Jackson 就会先序列化成 LinkedHashMap，然后再尝试强转为所需类别，这样大部分情况下会强转失败，异常信息如下</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>java.lang.ClassCastException: class java.util.LinkedHashMap cannot be cast to class org.springframework.security.core.context.SecurityContext</span></span></code></pre></div><p>这种情况需要添加一个配置，如下</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">objectMapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">activateDefaultTyping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    objectMapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">getPolymorphicTypeValidator</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(),  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    ObjectMapper.DefaultTyping.NON_FINAL,  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    JsonTypeInfo.As.PROPERTY);</span></span></code></pre></div><p>但是当添加了这个配置后重启后再次尝试发现还是有异常，不过这时就是因为框架中的类没有提供默认构造器造成的，异常如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>org.springframework.data.redis.serializer.SerializationException: Could not read JSON: Cannot construct instance of `org.springframework.security.authentication.UsernamePasswordAuthenticationToken` (no Creators, like default constructor, exist): cannot deserialize from Object value (no delegate- or property-based Creator)</span></span>
<span class="line"><span> at [Source: (byte[])&quot;{&quot;@class&quot;:&quot;org.springframework.security.core.context.SecurityContextImpl&quot;,&quot;authentication&quot;:{&quot;@class&quot;:&quot;org.springframework.security.authentication.UsernamePasswordAuthenticationToken&quot;,&quot;authorities&quot;:[&quot;java.util.Collections$UnmodifiableRandomAccessList&quot;,[{&quot;@class&quot;:&quot;com.example.model.security.CustomGrantedAuthority&quot;,&quot;authority&quot;:&quot;system&quot;},{&quot;@class&quot;:&quot;com.example.model.security.CustomGrantedAuthority&quot;,&quot;authority&quot;:&quot;app&quot;},{&quot;@class&quot;:&quot;com.example.model.security.CustomGrantedAuthority&quot;,&quot;authority&quot;:&quot;web&quot;}]],&quot;[truncated 893 bytes]; line: 1, column: 184] (through reference chain: org.springframework.security.core.context.SecurityContextImpl[&quot;authentication&quot;])</span></span></code></pre></div><p>异常提示问题在<code>SecurityContextImpl</code>的<code>authentication</code>属性上，因为该属性的实例是<code>UsernamePasswordAuthenticationToken</code>，这个类并没有一个默认的构造器，所以在反序列化时直接报错了，最开始时我的想法是写一个实现类，然后存取的时候用自定义的类中转一下，但是后来又发现了<code>Json Mixin</code>这个东西，发现这个玩意儿更方便，于是就实现了一下，写了一个<code>UsernamePasswordAuthenticationMixin</code>类来实现自定义反序列化逻辑，<strong>但是昨天突然发现这东西其实框架已经实现了，就很尴尬，要将这些东西加进来添加一下框架提供的<code>CoreJackson2Module</code>就行</strong>，配置如下：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 添加Security提供的Jackson Mixin  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">objectMapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">registerModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> CoreJackson2Module</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">());</span></span></code></pre></div><h1 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-label="Permalink to &quot;解决方案&quot;">​</a></h1><!----><p>Redis配置文件中配置的<code>RedisTemplate</code>添加值序列化器，值序列化器使用的<code>ObjectMapper</code>添加以上提到的那些配置，包括复杂类型映射、Security提供的<code>Json Mixin</code>，完整的Redis配置类如下</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> com.example.config;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> com.fasterxml.jackson.annotation.JsonAutoDetect;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> com.fasterxml.jackson.annotation.JsonTypeInfo;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> com.fasterxml.jackson.annotation.PropertyAccessor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> com.fasterxml.jackson.databind.ObjectMapper;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> lombok.RequiredArgsConstructor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> org.springframework.context.annotation.Bean;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> org.springframework.context.annotation.Configuration;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> org.springframework.data.redis.connection.RedisConnectionFactory;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> org.springframework.data.redis.core.RedisTemplate;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> org.springframework.data.redis.serializer.StringRedisSerializer;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> org.springframework.http.converter.json.Jackson2ObjectMapperBuilder;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> org.springframework.security.jackson2.CoreJackson2Module;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * Redis的key序列化配置类</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">@author</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> vains</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">RequiredArgsConstructor</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> RedisConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> Jackson2ObjectMapperBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> builder;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">     * 默认情况下使用</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;"> connectionFactory</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> redis链接工厂</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">@return</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> RedisTemplate</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">     */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> RedisTemplate&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">redisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(RedisConnectionFactory </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">connectionFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 字符串序列化器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        StringRedisSerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> stringRedisSerializer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> StringRedisSerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 创建ObjectMapper并添加默认配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        ObjectMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> objectMapper</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">createXmlMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 序列化所有字段</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        objectMapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">setVisibility</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 此项必须配置，否则如果序列化的对象里边还有对象，会报如下错误：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        //     java.lang.ClassCastException: java.util.LinkedHashMap cannot be cast to XXX</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        objectMapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">activateDefaultTyping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                objectMapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">getPolymorphicTypeValidator</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                ObjectMapper.DefaultTyping.NON_FINAL,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                JsonTypeInfo.As.PROPERTY);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 添加Security提供的Jackson Mixin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        objectMapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">registerModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> CoreJackson2Module</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 存入redis时序列化值的序列化器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        Jackson2JsonRedisSerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#F69D50;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#F69D50;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">valueSerializer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">                new</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> Jackson2JsonRedisSerializer&lt;&gt;(objectMapper, Object.class);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        RedisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#F69D50;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#F69D50;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#F69D50;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">redisTemplate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> RedisTemplate&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 设置值序列化</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">setValueSerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(valueSerializer);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 设置hash格式数据值的序列化器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">setHashValueSerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(valueSerializer);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 默认的Key序列化器为：JdkSerializationRedisSerializer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">setKeySerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(stringRedisSerializer);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 设置字符串序列化器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">setStringSerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(stringRedisSerializer);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 设置hash结构的key的序列化器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">setHashKeySerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(stringRedisSerializer);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 设置连接工厂</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">setConnectionFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(connectionFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> redisTemplate;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">     * 操作hash的情况下使用</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;"> connectionFactory</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> redis链接工厂</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">@return</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> RedisTemplate</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">     */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> RedisTemplate&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">redisHashTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(RedisConnectionFactory </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">connectionFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> redisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(connectionFactory);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h1 id="扩展说明" tabindex="-1">扩展说明 <a class="header-anchor" href="#扩展说明" aria-label="Permalink to &quot;扩展说明&quot;">​</a></h1><!----><p>从上边的配置可以看出<code>Spring</code>对于三方框架内部没有默认构造器的类的反序列化支持还是挺好的，如果集成其它框架时遇到这种情况时就可以仿照<code>Security</code>框架提供的<code>Mixin</code>类实现一个自己的<code>Mixin</code>类以支持反序列化，当然也可以找找在框架中是否有类似的<code>Jackson2Module</code>类；当自己封装一个<code>starter</code>时也可以提供<code>Jackson2Module</code>类来映射类，不过这个就按照个人的喜好来了，自己封装自由度很高的。</p><p>当然在使用<code>Security</code>时如果遇到其它反序列化失败的类，都可以在框架中找找有没有其它的<code>Jackson2Module</code>类，如果提供的有那就不用自己封装了，直接往<code>ObjectMapper</code>添加一个<code>Module</code>就行。</p></div></div></main><footer class="VPDocFooter" data-v-dc58f89e data-v-b8c7433f><!--[--><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--><!--]--><div class="edit-info" data-v-b8c7433f><div class="edit-link" data-v-b8c7433f><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/Charles7c/charles7c.github.io/edit/main/docs/authorization-server/02-优化篇/03-add-Jackson-Mixin.md" target="_blank" rel="noreferrer" data-v-b8c7433f><!--[--><span class="vpi-square-pen edit-link-icon" data-v-b8c7433f></span> 不妥之处，敬请雅正<!--]--></a></div><!----></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-b8c7433f><span class="visually-hidden" id="doc-footer-aria-label" data-v-b8c7433f>Pager</span><div class="pager" data-v-b8c7433f><!----></div><div class="pager" data-v-b8c7433f><a class="VPLink link pager-link next" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/01-what-is-Spring-OAuth2-Authorization-Server" data-v-b8c7433f><!--[--><span class="desc" data-v-b8c7433f>下一篇</span><span class="title" data-v-b8c7433f><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>什么是Spring OAuth2 Authorization Server</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"about_index.md\":\"CrrNnRv0\",\"about_me.md\":\"BiEL_bzB\",\"authorization-server_01-基础集成_01-what-is-spring-oauth2-authorization-server.md\":\"CEyP7AxT\",\"authorization-server_04-进阶教程_01-custom-token-payload.md\":\"CJw0dGLV\",\"authorization-server_index.md\":\"Dp-6TR3D\",\"index.md\":\"C4D6vr7d\",\"archives.md\":\"Bk-WBTDQ\",\"authorization-server_04-进阶教程_06-gateway-integration-server-provider.md\":\"BZmtwjQm\",\"authorization-server_02-优化篇_01-add-redis-support-common-result.md\":\"BFtVPkmb\",\"authorization-server_03-自定义grant type_02-custom-grant-type-sms-captcha-get-access-token.md\":\"B1mSbcC9\",\"authorization-server_04-进阶教程_02-oauth2-client-integration-server-provider.md\":\"CP3B0zod\",\"authorization-server_04-进阶教程_05-vue-integration-server-provider-with-pkce.md\":\"CxlyZm6o\",\"authorization-server_01-基础集成_06-faq.md\":\"CCjTIxlM\",\"authorization-server_04-进阶教程_04-vue-integration-server-provider-with-authorization-code.md\":\"D9Z3k2fA\",\"authorization-server_01-基础集成_02-spring-boot-sample-integration.md\":\"Bjrzi_bB\",\"authorization-server_03-自定义grant type_01-device-code-flow.md\":\"CbKCOF3H\",\"authorization-server_01-基础集成_03-custom-exception-catch.md\":\"QdjjwJcb\",\"authorization-server_01-基础集成_04-login-add-captcha.md\":\"fKaVydyR\",\"authorization-server_01-基础集成_05-login-add-sms-login-type.md\":\"DfTYB5jq\",\"authorization-server_04-进阶教程_03-resource-server-integration-server-provider.md\":\"i_vQd7Ct\",\"authorization-server_04-进阶教程_10-qr-code-login.md\":\"Ba_bZpjn\",\"authorization-server_02-优化篇_02-custom-userdetailsservice.md\":\"htU18ZJz\",\"authorization-server_04-进阶教程_07-split-login-page.md\":\"DTxfn0gm\",\"authorization-server_02-优化篇_03-add-jackson-mixin.md\":\"42dt8lo3\",\"authorization-server_05-联合身份认证_01-github-gitee-federation.md\":\"DXt5bGn5\",\"authorization-server_04-进阶教程_09-implement-core-services-with-redis.md\":\"1yOiJonK\",\"authorization-server_04-进阶教程_08-split-consent-device-validation-page.md\":\"CyZyv8OT\",\"authorization-server_05-联合身份认证_02-wechat-federation.md\":\"D6oTdGoH\",\"tags.md\":\"DIJPTehm\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"云逸的知识库\",\"description\":\"个人技术知识库，记录和分享个人碎片化、结构化、体系化的技术知识内容\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Spring OAuth2 Authorization Server\",\"link\":\"/authorization-server/01-基础集成/01-what-is-Spring-OAuth2-Authorization-Server\"},{\"text\":\"我的标签\",\"link\":\"/tags\",\"activeMatch\":\"/tags\"},{\"text\":\"我的归档\",\"link\":\"/archives\",\"activeMatch\":\"/archives\"}],\"sidebar\":{\"/authorization-server/\":[{\"text\":\"基础集成 (6篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>什么是Spring OAuth2 Authorization Server\",\"link\":\"/authorization-server//01-基础集成/01-what-is-Spring-OAuth2-Authorization-Server\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>简单集成\",\"link\":\"/authorization-server//01-基础集成/02-Spring-Boot-sample-integration\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>自定义异常响应处理\",\"link\":\"/authorization-server//01-基础集成/03-custom-exception-catch\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>登录页面添加图片验证码\",\"link\":\"/authorization-server//01-基础集成/04-login-add-captcha\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>扩展登录-添加短信登录\",\"link\":\"/authorization-server//01-基础集成/05-login-add-sms-login-type\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">6</div>常见问题解答(FAQ)\",\"link\":\"/authorization-server//01-基础集成/06-FAQ\"}],\"collapsed\":false},{\"text\":\"优化篇 (3篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>添加redis支持和统一响应处理\",\"link\":\"/authorization-server//02-优化篇/01-add-redis-support-common-result\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>自定义UserDetails实现从数据库获取用户信息\",\"link\":\"/authorization-server//02-优化篇/02-custom-UserDetailsService\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>添加Jackson Mixin解决redis序列化失败问题\",\"link\":\"/authorization-server//02-优化篇/03-add-Jackson-Mixin\"}],\"collapsed\":false},{\"text\":\"自定义grant type (2篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>集成设备码授权\",\"link\":\"/authorization-server//03-自定义grant type/01-device-code-flow\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>扩展grant type(短信登录)\",\"link\":\"/authorization-server//03-自定义grant type/02-custom-grant-type-sms-captcha-get-access-token\"}],\"collapsed\":false},{\"text\":\"进阶教程 (10篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>扩展grant type(短信登录)\",\"link\":\"/authorization-server//04-进阶教程/01-custom-token-payload\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>OAuth2客户端对接认证服务\",\"link\":\"/authorization-server//04-进阶教程/02-oauth2-client-integration-server-provider\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>资源服务对接认证服务\",\"link\":\"/authorization-server//04-进阶教程/03-resource-server-integration-server-provider\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>Vue通过授权码对接认证服务\",\"link\":\"/authorization-server//04-进阶教程/04-vue-integration-server-provider-with-authorization-code\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>Vue通过PKCE对接认证服务\",\"link\":\"/authorization-server//04-进阶教程/05-vue-integration-server-provider-with-pkce\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">6</div>网关对接认证服务\",\"link\":\"/authorization-server//04-进阶教程/06-gateway-integration-server-provider\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">7</div>前后端分离-登录页面\",\"link\":\"/authorization-server//04-进阶教程/07-split-login-page\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">8</div>前后端分离-授权确认和设备码\",\"link\":\"/authorization-server//04-进阶教程/08-split-consent-device-validation-page\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">9</div>基于redis的核心服务实现\",\"link\":\"/authorization-server//04-进阶教程/09-implement-core-services-with-redis\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">10</div>扫码登录实现\",\"link\":\"/authorization-server//04-进阶教程/10-qr-code-login\"}],\"collapsed\":true},{\"text\":\"联合身份认证 (2篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>联合身份认证-gitee、github\",\"link\":\"/authorization-server//05-联合身份认证/01-github-gitee-federation\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>联合身份认证-微信登录\",\"link\":\"/authorization-server//05-联合身份认证/02-wechat-federation\"}],\"collapsed\":true}]},\"logo\":\"/logo.png\",\"outline\":{\"level\":[1,6],\"label\":\"目录\"},\"darkModeSwitchLabel\":\"切换日光/暗黑模式\",\"sidebarMenuLabel\":\"文章\",\"returnToTopLabel\":\"返回顶部\",\"lastUpdatedText\":\"最后更新\",\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"editLink\":{\"pattern\":\"https://github.com/Charles7c/charles7c.github.io/edit/main/docs/:path\",\"text\":\"不妥之处，敬请雅正\"},\"search\":{\"provider\":\"local\",\"options\":{\"locales\":{\"root\":{\"translations\":{\"button\":{\"buttonText\":\"搜索文档\",\"buttonAriaLabel\":\"搜索文档\"},\"modal\":{\"noResultsText\":\"无法找到相关结果\",\"resetButtonTitle\":\"清除查询条件\",\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\"}}}}}}},\"socialLinks\":[],\"articleMetadataConfig\":{\"author\":\"vains\",\"authorLink\":\"/about/me\",\"showViewCount\":false},\"copyrightConfig\":{\"license\":\"署名-相同方式共享 4.0 国际 (CC BY-SA 4.0)\",\"licenseLink\":\"http://creativecommons.org/licenses/by-sa/4.0/\"},\"commentConfig\":{\"type\":\"gitalk\",\"showComment\":true},\"footerConfig\":{\"showFooter\":false,\"icpRecordCode\":\"津ICP备2022005864号-2\",\"publicSecurityRecordCode\":\"津公网安备12011202000677号\",\"copyright\":\"Copyright © 2019-2024 Charles7c\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>