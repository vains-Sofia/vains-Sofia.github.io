import{d,j as m}from"./index-6033af98.js";import{q as p,J as h,s as c,K as _,M as i}from"./Login-dfc7f148.js";import"./Card-09e91a9d.js";const w=d({__name:"PkceRedirect",setup(u){const{message:a}=p(["message"]);let s=i(),n=h(s),o=i();const r=c("code");if(r){const t=localStorage.getItem("state");if(c("state")!==t)a.warning("state校验失败.");else{const g=localStorage.getItem("codeVerifier");_({grant_type:"authorization_code",client_id:"pkce-message-client",redirect_uri:"https://vains-sofia.gitee.io/PkceRedirect",code:r,code_verifier:g,state:t}).then(e=>{localStorage.setItem("accessToken",JSON.stringify(e)),m.push({path:"/"})}).catch(e=>{a.warning(`请求token失败：${e.data.error||e.message||e.statusText}`)})}}else localStorage.setItem("state",o),localStorage.setItem("codeVerifier",s),window.location.href=`https://oauth-hwrjm8vk.b4a.run/oauth2/authorize?response_type=code&client_id=pkce-message-client&redirect_uri=${encodeURIComponent("https://vains-sofia.gitee.io/PkceRedirect")}&scope=message.write%20message.read&code_challenge=${n}&code_challenge_method=S256&state=${o}`;return(t,l)=>"加载中..."}});export{w as default};
