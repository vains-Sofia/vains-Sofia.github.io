import{d as g,j as _,_ as p}from"./index-d211578b.js";import{q as m,J as f,s as i,K as h,M as c}from"./Login-01fe4057.js";import"./Card-f6d8f7c1.js";const u=g({__name:"PkceRedirect",setup(S){const{message:o}=m(["message"]);let s=c(),n=f(s),a=c();const r=i("code");if(r){const t=localStorage.getItem("state");if(i("state")!==t)o.warning("state校验失败.");else{const d=localStorage.getItem("codeVerifier");h({grant_type:"authorization_code",client_id:"pkce-message-client",redirect_uri:"https://vains-sofia.gitee.io/PkceRedirect",code:r,code_verifier:d,state:t}).then(e=>{localStorage.setItem("accessToken",JSON.stringify(e)),_.push({path:"/"})}).catch(e=>{o.warning(`请求token失败：${e.data.error||e.message||e.statusText}`)})}}else localStorage.setItem("state",a),localStorage.setItem("codeVerifier",s),window.location.href=`https://oauth.flow-cloud.love/oauth2/authorize?response_type=code&client_id=pkce-message-client&redirect_uri=${encodeURIComponent("https://vains-sofia.gitee.io/PkceRedirect")}&scope=message.write%20message.read&code_challenge=${n}&code_challenge_method=S256&state=${a}`;return(t,l)=>"加载中..."}}),R=p(u,[["__file","D:/OtherFiles/GitRepository/vains-Sofia-login/src/views/login/PkceRedirect.vue"]]);export{R as default};
