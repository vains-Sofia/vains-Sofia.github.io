import{_ as g}from"./chunks/ArticleMetadata.DArXzXOG.js";import{_ as D,m as y,a as C,u as p,B as e,e as s,x as t,ai as A,o as h,p as r,q as d,bo as o,bp as c,bq as B,br as F,bs as E,bt as u,bu as m}from"./chunks/framework.DGhdORX1.js";import"./chunks/theme.C7H76Bwr.js";const L=JSON.parse('{"title":"联合身份认证-微信登录","description":"","frontmatter":{"title":"联合身份认证-微信登录","author":"vains","date":"2024-05-05 13:00","isTop":"fasle","categories":["认证服务集成"],"tags":["Spring Boot","Spring Security","Spring Security OAuth2 Client","Spring OAuth2 Authorization Server"],"showComment":false},"headers":[],"relativePath":"authorization-server/05-联合身份认证/02-wechat-federation.md","filePath":"authorization-server/05-联合身份认证/02-wechat-federation.md","lastUpdated":null}'),q={name:"authorization-server/05-联合身份认证/02-wechat-federation.md"},v=s("h1",{id:"前言",tabindex:"-1"},[t("前言 "),s("a",{class:"header-anchor",href:"#前言","aria-label":'Permalink to "前言"'},"​")],-1),b=s("p",null,[t("微信登录使用需要进行资质认证，虽然公众平台提供了测试号，但是测试号只能用在微信浏览器打开的网页中使用，如果将测试号用于扫码登录，则会提示scope参数错误；虽然微信登录的流程也是oauth的那一套流程，但是它要求的参数并不符合oauth的规范，所以想要集成进联合身份认证中则需要根据参数要求进行定制。"),s("strong",null,[s("a",{href:"https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login",target:"_blank",rel:"noreferrer"},"微信公众平台测试号申请地址")]),s("br"),t("接下来就该展示本人的三板斧了，理论、编码、测试。")],-1),R=s("p",null,[s("strong",null,"如果不想看分析可以直接拉至中间的代码部分")],-1),_=s("h1",{id:"定制分析",tabindex:"-1"},[t("定制分析 "),s("a",{class:"header-anchor",href:"#定制分析","aria-label":'Permalink to "定制分析"'},"​")],-1),T=A("",24),f=A("",36),O=A("",7),S=s("p",null,[t("虽然这次是用测试号对接的，但是实际上开放平台提供的扫码登录也是这个流程，直接替换appid和app secret为开放平台申请的应该能直接使用；另外需要注意的是获取access_token时可能会返回"),s("code",null,"unionid"),t("，这是在同一个微信开放平台账号下拥有多个移动应用、网站应用和公众账号，获取用户信息后用户信息中的openid可能不同，但是unionid是相同的，可以通过unionid区分用户。所以可以在三方用户表中多加一个字段来存放unionid或者openid。")],-1),P=s("h1",{id:"附录",tabindex:"-1"},[t("附录 "),s("a",{class:"header-anchor",href:"#附录","aria-label":'Permalink to "附录"'},"​")],-1),w=s("ol",null,[s("li",null,[t("微信网页授权登录文档："),s("a",{href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html",target:"_blank",rel:"noreferrer"},"地址")]),s("li",null,[t("微信测试号申请地址："),s("a",{href:"https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login",target:"_blank",rel:"noreferrer"},"地址")]),s("li",null,[t("Security OAuth2 Client文档地址："),s("a",{href:"https://docs.spring.io/spring-security/reference/servlet/oauth2/index.html",target:"_blank",rel:"noreferrer"},"地址")])],-1);function z(i,x,U,M,N,I){const k=g,l=y("ClientOnly");return h(),C("div",null,[v,p(l,null,{default:e(()=>{var a,n;return[(((a=i.$frontmatter)==null?void 0:a.aside)??!0)&&(((n=i.$frontmatter)==null?void 0:n.showArticleMetadata)??!0)?(h(),r(k,{key:0,article:i.$frontmatter},null,8,["article"])):d("",!0)]}),_:1}),b,R,_,p(l,null,{default:e(()=>{var a,n;return[(((a=i.$frontmatter)==null?void 0:a.aside)??!0)&&(((n=i.$frontmatter)==null?void 0:n.showArticleMetadata)??!0)?(h(),r(k,{key:0,article:i.$frontmatter},null,8,["article"])):d("",!0)]}),_:1}),T,p(l,null,{default:e(()=>{var a,n;return[(((a=i.$frontmatter)==null?void 0:a.aside)??!0)&&(((n=i.$frontmatter)==null?void 0:n.showArticleMetadata)??!0)?(h(),r(k,{key:0,article:i.$frontmatter},null,8,["article"])):d("",!0)]}),_:1}),f,p(l,null,{default:e(()=>{var a,n;return[(((a=i.$frontmatter)==null?void 0:a.aside)??!0)&&(((n=i.$frontmatter)==null?void 0:n.showArticleMetadata)??!0)?(h(),r(k,{key:0,article:i.$frontmatter},null,8,["article"])):d("",!0)]}),_:1}),O,p(l,null,{default:e(()=>{var a,n;return[(((a=i.$frontmatter)==null?void 0:a.aside)??!0)&&(((n=i.$frontmatter)==null?void 0:n.showArticleMetadata)??!0)?(h(),r(k,{key:0,article:i.$frontmatter},null,8,["article"])):d("",!0)]}),_:1}),S,P,p(l,null,{default:e(()=>{var a,n;return[(((a=i.$frontmatter)==null?void 0:a.aside)??!0)&&(((n=i.$frontmatter)==null?void 0:n.showArticleMetadata)??!0)?(h(),r(k,{key:0,article:i.$frontmatter},null,8,["article"])):d("",!0)]}),_:1}),w])}const G=D(q,[["render",z]]);export{L as __pageData,G as default};
