<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue通过授权码对接认证服务 | 云逸的知识库</title>
    <meta name="description" content="个人技术知识库，记录和分享个人碎片化、结构化、体系化的技术知识内容">
    <meta name="generator" content="VitePress v1.1.4">
    <link rel="preload stylesheet" href="/assets/style.pCaHnWZu.css" as="style">
    
    <script type="module" src="/assets/app.D-N1sCaq.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.DGhdORX1.js">
    <link rel="modulepreload" href="/assets/chunks/theme.C7H76Bwr.js">
    <link rel="modulepreload" href="/assets/chunks/katex-ffb0e8f1.xpx6yKzS.js">
    <link rel="modulepreload" href="/assets/chunks/c4Diagram-e2511a7a.BeYfI28Y.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-e44a2353.CVgjLZgB.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-v2-a8396bb5.Dyg2sl1l.js">
    <link rel="modulepreload" href="/assets/chunks/erDiagram-582bd92f.BVmqCITn.js">
    <link rel="modulepreload" href="/assets/chunks/gitGraphDiagram-d5d647e9.DBGievCq.js">
    <link rel="modulepreload" href="/assets/chunks/ganttDiagram-05e48839.BWW36Htb.js">
    <link rel="modulepreload" href="/assets/chunks/infoDiagram-00deb277.BgqqP1d7.js">
    <link rel="modulepreload" href="/assets/chunks/pieDiagram-35c7eafc.DDAQrYyX.js">
    <link rel="modulepreload" href="/assets/chunks/quadrantDiagram-9c93c009.Dv-Yp9zF.js">
    <link rel="modulepreload" href="/assets/chunks/xychartDiagram-7b46ecfd.BtRfe_UM.js">
    <link rel="modulepreload" href="/assets/chunks/requirementDiagram-e882bd67.CzeNAERw.js">
    <link rel="modulepreload" href="/assets/chunks/sequenceDiagram-1767341c.C1hwsnyl.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-3275847a.BuzMvcXR.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-v2-2ed0a7d3.CL1ZcBud.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-d2e6f24f.DiZ-K_zk.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-v2-21d485ae.CvM-KFZe.js">
    <link rel="modulepreload" href="/assets/chunks/journeyDiagram-a5efd2e1.BSFuB01C.js">
    <link rel="modulepreload" href="/assets/chunks/flowchart-elk-definition-1a3aaf5d.8mDLKORw.js">
    <link rel="modulepreload" href="/assets/chunks/timeline-definition-f8c5dfc0.CoymNc-h.js">
    <link rel="modulepreload" href="/assets/chunks/mindmap-definition-74120bdd.BuEDPwLq.js">
    <link rel="modulepreload" href="/assets/chunks/sankeyDiagram-f5d051b7.D-XVi6Lq.js">
    <link rel="modulepreload" href="/assets/chunks/blockDiagram-8beecd1f.AwlZ6TWF.js">
    <link rel="modulepreload" href="/assets/chunks/virtual_mermaid-config.DDnGl6nM.js">
    <link rel="modulepreload" href="/assets/chunks/ArticleMetadata.DArXzXOG.js">
    <link rel="modulepreload" href="/assets/authorization-server_04-进阶教程_04-vue-integration-server-provider-with-authorization-code.md.D9Z3k2fA.lean.js">
    <link rel="icon" href="/favicon.ico">
    <meta name="author" content="Charles7c">
    <meta name="keywords" content="查尔斯的知识库, 知识库, 博客, Charles7c">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="theme-color" content="#3c8772">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:title" content="云逸的知识库">
    <meta property="og:description" content="个人技术知识库，记录和分享个人碎片化、结构化、体系化的技术知识内容">
    <meta property="og:site" content="https://vains-sofia.gitee.io">
    <meta property="og:site_name" content="云逸的知识库">
    <meta property="og:image" content="https://vains-sofia.gitee.io/logo.jpg">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-654777d8><!--[--><!--]--><!--[--><span tabindex="-1" data-v-35de2ca8></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-35de2ca8> Skip to content </a><!--]--><!----><header class="VPNav" data-v-654777d8 data-v-43e376a4><div class="VPNavBar has-sidebar top" data-v-43e376a4 data-v-9791a0f2><div class="wrapper" data-v-9791a0f2><div class="container" data-v-9791a0f2><div class="title" data-v-9791a0f2><div class="VPNavBarTitle has-sidebar" data-v-9791a0f2 data-v-5a7a6776><a class="title" href="/" data-v-5a7a6776><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.png" alt data-v-0bbaa066><!--]--><span data-v-5a7a6776>云逸的知识库</span><!--[--><!--]--></a></div></div><div class="content" data-v-9791a0f2><div class="content-body" data-v-9791a0f2><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9791a0f2><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9791a0f2 data-v-587b0e42><span id="main-nav-aria-label" class="visually-hidden" data-v-587b0e42>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/01-what-is-Spring-OAuth2-Authorization-Server" tabindex="0" data-v-587b0e42 data-v-50f19583><!--[--><span data-v-50f19583>Spring OAuth2 Authorization Server</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/tags" tabindex="0" data-v-587b0e42 data-v-50f19583><!--[--><span data-v-50f19583>我的标签</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/archives" tabindex="0" data-v-587b0e42 data-v-50f19583><!--[--><span data-v-50f19583>我的归档</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9791a0f2 data-v-739278fe><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-739278fe data-v-ce69ce15 data-v-edbcc6c0><span class="check" data-v-edbcc6c0><span class="icon" data-v-edbcc6c0><!--[--><span class="vpi-sun sun" data-v-ce69ce15></span><span class="vpi-moon moon" data-v-ce69ce15></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9791a0f2 data-v-c2b8a29d data-v-c279aa26><!--[--><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9791a0f2 data-v-8370ed8b data-v-49c23037><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-49c23037><span class="vpi-more-horizontal icon" data-v-49c23037></span></button><div class="menu" data-v-49c23037><div class="VPMenu" data-v-49c23037 data-v-c8414c67><!----><!--[--><!--[--><!----><div class="group" data-v-8370ed8b><div class="item appearance" data-v-8370ed8b><p class="label" data-v-8370ed8b>切换日光/暗黑模式</p><div class="appearance-action" data-v-8370ed8b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-8370ed8b data-v-ce69ce15 data-v-edbcc6c0><span class="check" data-v-edbcc6c0><span class="icon" data-v-edbcc6c0><!--[--><span class="vpi-sun sun" data-v-ce69ce15></span><span class="vpi-moon moon" data-v-ce69ce15></span><!--]--></span></span></button></div></div></div><div class="group" data-v-8370ed8b><div class="item social-links" data-v-8370ed8b><div class="VPSocialLinks social-links-list" data-v-8370ed8b data-v-c279aa26><!--[--><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9791a0f2 data-v-a275a8ec><span class="container" data-v-a275a8ec><span class="top" data-v-a275a8ec></span><span class="middle" data-v-a275a8ec></span><span class="bottom" data-v-a275a8ec></span></span></button></div></div></div></div><div class="divider" data-v-9791a0f2><div class="divider-line" data-v-9791a0f2></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-654777d8 data-v-80853cd5><div class="container" data-v-80853cd5><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-80853cd5><span class="vpi-align-left menu-icon" data-v-80853cd5></span><span class="menu-text" data-v-80853cd5>文章</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-80853cd5 data-v-33ddb4b9><button data-v-33ddb4b9>返回顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-654777d8 data-v-73e27b6b><div class="curtain" data-v-73e27b6b></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-73e27b6b><span class="visually-hidden" id="sidebar-aria-label" data-v-73e27b6b> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-73e27b6b><section class="VPSidebarItem level-0 collapsible" data-v-73e27b6b data-v-3a5dabe3><div class="item" role="button" tabindex="0" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><h2 class="text" data-v-3a5dabe3>基础集成 (6篇)</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3a5dabe3><span class="vpi-chevron-right caret-icon" data-v-3a5dabe3></span></div></div><div class="items" data-v-3a5dabe3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/01-what-is-Spring-OAuth2-Authorization-Server" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>什么是Spring OAuth2 Authorization Server</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/02-Spring-Boot-sample-integration" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-orange mr-[6px]" style="font-weight: 550; display: inline-block;">2</div>简单集成</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/03-custom-exception-catch" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-yellow mr-[6px]" style="font-weight: 550; display: inline-block;">3</div>自定义异常响应处理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/04-login-add-captcha" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">4</div>登录页面添加图片验证码</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/05-login-add-sms-login-type" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">5</div>扩展登录-添加短信登录</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/06-FAQ" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">6</div>常见问题解答(FAQ)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-73e27b6b><section class="VPSidebarItem level-0 collapsible" data-v-73e27b6b data-v-3a5dabe3><div class="item" role="button" tabindex="0" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><h2 class="text" data-v-3a5dabe3>优化篇 (3篇)</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3a5dabe3><span class="vpi-chevron-right caret-icon" data-v-3a5dabe3></span></div></div><div class="items" data-v-3a5dabe3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/02-%E4%BC%98%E5%8C%96%E7%AF%87/01-add-redis-support-common-result" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>添加redis支持和统一响应处理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/02-%E4%BC%98%E5%8C%96%E7%AF%87/02-custom-UserDetailsService" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-orange mr-[6px]" style="font-weight: 550; display: inline-block;">2</div>自定义UserDetails实现从数据库获取用户信息</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/02-%E4%BC%98%E5%8C%96%E7%AF%87/03-add-Jackson-Mixin" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-yellow mr-[6px]" style="font-weight: 550; display: inline-block;">3</div>添加Jackson Mixin解决redis序列化失败问题</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-73e27b6b><section class="VPSidebarItem level-0 collapsible" data-v-73e27b6b data-v-3a5dabe3><div class="item" role="button" tabindex="0" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><h2 class="text" data-v-3a5dabe3>自定义grant type (2篇)</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3a5dabe3><span class="vpi-chevron-right caret-icon" data-v-3a5dabe3></span></div></div><div class="items" data-v-3a5dabe3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/03-%E8%87%AA%E5%AE%9A%E4%B9%89grant%20type/01-device-code-flow" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>集成设备码授权</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/03-%E8%87%AA%E5%AE%9A%E4%B9%89grant%20type/02-custom-grant-type-sms-captcha-get-access-token" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-orange mr-[6px]" style="font-weight: 550; display: inline-block;">2</div>扩展grant type(短信登录)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-73e27b6b><section class="VPSidebarItem level-0 collapsible collapsed" data-v-73e27b6b data-v-3a5dabe3><div class="item" role="button" tabindex="0" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><h2 class="text" data-v-3a5dabe3>进阶教程 (10篇)</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3a5dabe3><span class="vpi-chevron-right caret-icon" data-v-3a5dabe3></span></div></div><div class="items" data-v-3a5dabe3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/01-custom-token-payload" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>扩展grant type(短信登录)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/02-oauth2-client-integration-server-provider" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-orange mr-[6px]" style="font-weight: 550; display: inline-block;">2</div>OAuth2客户端对接认证服务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/03-resource-server-integration-server-provider" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-yellow mr-[6px]" style="font-weight: 550; display: inline-block;">3</div>资源服务对接认证服务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/04-vue-integration-server-provider-with-authorization-code" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">4</div>Vue通过授权码对接认证服务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/05-vue-integration-server-provider-with-pkce" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">5</div>Vue通过PKCE对接认证服务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/06-gateway-integration-server-provider" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">6</div>网关对接认证服务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/07-split-login-page" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">7</div>前后端分离-登录页面</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/08-split-consent-device-validation-page" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">8</div>前后端分离-授权确认和设备码</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/09-implement-core-services-with-redis" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">9</div>基于redis的核心服务实现</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/10-qr-code-login" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">10</div>扫码登录实现</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-73e27b6b><section class="VPSidebarItem level-0 collapsible collapsed" data-v-73e27b6b data-v-3a5dabe3><div class="item" role="button" tabindex="0" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><h2 class="text" data-v-3a5dabe3>联合身份认证 (2篇)</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3a5dabe3><span class="vpi-chevron-right caret-icon" data-v-3a5dabe3></span></div></div><div class="items" data-v-3a5dabe3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/05-%E8%81%94%E5%90%88%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/01-github-gitee-federation" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>联合身份认证-gitee、github</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3a5dabe3 data-v-3a5dabe3><div class="item" data-v-3a5dabe3><div class="indicator" data-v-3a5dabe3></div><a class="VPLink link link" href="/authorization-server/05-%E8%81%94%E5%90%88%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/02-wechat-federation" data-v-3a5dabe3><!--[--><p class="text" data-v-3a5dabe3><div class="text-color-orange mr-[6px]" style="font-weight: 550; display: inline-block;">2</div>联合身份认证-微信登录</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-654777d8 data-v-748affb0><div class="VPDoc has-sidebar has-aside" data-v-748affb0 data-v-dc58f89e><!--[--><!--]--><div class="container" data-v-dc58f89e><div class="aside" data-v-dc58f89e><div class="aside-curtain" data-v-dc58f89e></div><div class="aside-container" data-v-dc58f89e><div class="aside-content" data-v-dc58f89e><div class="VPDocAside" data-v-dc58f89e data-v-aa7136e9><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" role="navigation" data-v-aa7136e9 data-v-5519f07f><div class="content" data-v-5519f07f><div class="outline-marker" data-v-5519f07f></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-5519f07f>目录</div><ul class="VPDocOutlineItem root" data-v-5519f07f data-v-db339dd9><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-aa7136e9></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-dc58f89e><div class="content-container" data-v-dc58f89e><!--[--><!--]--><main class="main" data-v-dc58f89e><div style="position:relative;" class="vp-doc _authorization-server_04-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B_04-vue-integration-server-provider-with-authorization-code" data-v-dc58f89e><div><h1 id="vue单页面项目使用授权码模式对接流程说明" tabindex="-1">Vue单页面项目使用授权码模式对接流程说明 <a class="header-anchor" href="#vue单页面项目使用授权码模式对接流程说明" aria-label="Permalink to &quot;Vue单页面项目使用授权码模式对接流程说明&quot;">​</a></h1><!----><p><strong>以下流程摘抄自官网</strong></p><p>在本例中为授权代码流程。 授权码流程的步骤如下：</p><ol><li><p>客户端通过重定向到授权端点来发起 OAuth2 请求。</p></li><li><p>如果用户未通过身份验证，授权服务器将重定向到登录页面。 身份验证后，用户将再次重定向回授权端点。</p></li><li><p>如果用户未同意所请求的范围并且需要同意，则会显示同意页面。</p></li><li><p>一旦用户同意，授权服务器会生成一个<code>authorization_code</code>并通过<code>redirect_uri</code>重定向回客户端。</p></li><li><p>客户端通过查询参数获取<code>authorization_code</code>并向<a href="https://docs.spring.io/spring-authorization-server/docs/current/reference/html/protocol-endpoints.html#oauth2-token-endpoint" target="_blank" rel="noreferrer">Token Endpoint</a>发起请求。</p></li></ol><h1 id="vue项目中修改内容" tabindex="-1">Vue项目中修改内容 <a class="header-anchor" href="#vue项目中修改内容" aria-label="Permalink to &quot;Vue项目中修改内容&quot;">​</a></h1><!----><h2 id="安装crypto-js依赖" tabindex="-1">安装crypto-js依赖 <a class="header-anchor" href="#安装crypto-js依赖" aria-label="Permalink to &quot;安装crypto-js依赖&quot;">​</a></h2><p>已安装可以忽略，该依赖是为了计算<code>Code Challenge</code>和base64加密使用</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> crypto-js</span></span></code></pre></div><h2 id="typescript下额外添加-types-crypto-js依赖" tabindex="-1">TypeScript下额外添加<code>@types/crypto-js</code>依赖 <a class="header-anchor" href="#typescript下额外添加-types-crypto-js依赖" aria-label="Permalink to &quot;TypeScript下额外添加`@types/crypto-js`依赖&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> @types/crypto-js</span></span></code></pre></div><h2 id="编写公共方法" tabindex="-1">编写公共方法 <a class="header-anchor" href="#编写公共方法" aria-label="Permalink to &quot;编写公共方法&quot;">​</a></h2><h3 id="生成随机字符串" tabindex="-1">生成随机字符串 <a class="header-anchor" href="#生成随机字符串" aria-label="Permalink to &quot;生成随机字符串&quot;">​</a></h3><p><code>generateCodeVerifier</code> 函数主要是为了给PKCE流程使用，下篇文章中会说明，这里借用一下生成state，因为本质上是生成随机字符串</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * 生成 CodeVerifier</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * return CodeVerifier</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> generateCodeVerifier</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> generateRandomString</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">32</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * 生成随机字符串</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">@param</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> length</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> 随机字符串的长度</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">@returns</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> 随机字符串</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> generateRandomString</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> possible</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> length; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> possible.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">charAt</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">floor</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">random</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> possible.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> text</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="编写base64加密方法" tabindex="-1">编写base64加密方法 <a class="header-anchor" href="#编写base64加密方法" aria-label="Permalink to &quot;编写base64加密方法&quot;">​</a></h3><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * 将字符串加密为Base64格式的</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">@param</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> str</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> 将要转为base64的字符串</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">@returns</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> 返回base64格式的字符串</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> base64Str</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">str</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> CryptoJS.enc.Base64.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(CryptoJS.enc.Utf8.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(str));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="编写获取地址栏参数方法" tabindex="-1">编写获取地址栏参数方法 <a class="header-anchor" href="#编写获取地址栏参数方法" aria-label="Permalink to &quot;编写获取地址栏参数方法&quot;">​</a></h3><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * 根据参数name获取地址栏的参数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">@param</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> name</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> 地址栏参数的key</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">@returns</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> key对用的值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> getQueryString</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> reg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> RegExp</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;(^|&amp;)&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;=([^&amp;]*)(&amp;|$)&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;i&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> window.location.search.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">substr</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">match</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(reg)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> decodeURIComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(r[</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="编写请求token方法" tabindex="-1">编写请求Token方法 <a class="header-anchor" href="#编写请求token方法" aria-label="Permalink to &quot;编写请求Token方法&quot;">​</a></h3><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * 从认证服务获取AccessToken</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">@param</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> data</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> 获取token入参</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">@returns</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> 返回AccessToken对象</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> getToken</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> any</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        &#39;Content-Type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;application/x-www-form-urlencoded&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    // 这里这么写是为了兼容PKCE与授权码模式</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (data.client_secret) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 设置客户端的basic认证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        headers.Authorization </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> `Basic ${</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">base64Str</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">`${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">client_id</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}:${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">client_secret</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}`</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}`</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 移除入参中的key</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        delete</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> data.client_id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        delete</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> data.client_secret</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    // 可以设置为AccessToken的类型</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> loginRequest.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        url: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;/oauth2/token&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        data,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        headers</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="在环境变量配置文件中添加配置" tabindex="-1">在环境变量配置文件中添加配置 <a class="header-anchor" href="#在环境变量配置文件中添加配置" aria-label="Permalink to &quot;在环境变量配置文件中添加配置&quot;">​</a></h3><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"># </span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">认证服务地址</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(token签发地址)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">VITE_OAUTH_ISSUER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">//127.0.0.1:8080</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"># 授权码流程使用的客户端Id</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">VITE_OAUTH_CLIENT_ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">messaging</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">client</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"># 授权码流程使用的客户端秘钥</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">VITE_OAUTH_CLIENT_SECRET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">123456</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"># 授权码模式使用的回调地址</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">VITE_OAUTH_REDIRECT_URI</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">//127.0.0.1:5173/OAuth2Redirect</span></span></code></pre></div><h2 id="创建处理回调的页面oauthredirect-vue" tabindex="-1">创建处理回调的页面<code>OAuthRedirect.vue</code> <a class="header-anchor" href="#创建处理回调的页面oauthredirect-vue" aria-label="Permalink to &quot;创建处理回调的页面`OAuthRedirect.vue`&quot;">​</a></h2><p>页面加载时会尝试从地址栏获取参数<code>code</code>，如果能获取到说明是从认证服务回调过来的，执行换取token流程，如果没有获取到code说明需要发起授权申请。</p><p><strong>我这里是将获取到的token直接存储在localStorage中了，如果有需要也可以更换存储位置、存储格式等</strong></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> setup</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> lang</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">import router from &#39;../../router&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">import </span><span style="--shiki-light:#24292E;--shiki-dark:#F47067;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> getToken </span><span style="--shiki-light:#24292E;--shiki-dark:#F47067;">}</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> from &#39;@/api/Login&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">import </span><span style="--shiki-light:#24292E;--shiki-dark:#F47067;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> createDiscreteApi </span><span style="--shiki-light:#24292E;--shiki-dark:#F47067;">}</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> from &#39;naive-ui&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">import </span><span style="--shiki-light:#24292E;--shiki-dark:#F47067;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> generateCodeVerifier </span><span style="--shiki-light:#24292E;--shiki-dark:#F47067;">}</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> from &#39;@/util/pkce&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">import </span><span style="--shiki-light:#24292E;--shiki-dark:#F47067;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> getQueryString </span><span style="--shiki-light:#24292E;--shiki-dark:#F47067;">}</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> from &#39;@/util/GlobalUtils&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">const </span><span style="--shiki-light:#24292E;--shiki-dark:#F47067;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> message </span><span style="--shiki-light:#24292E;--shiki-dark:#F47067;">}</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> = createDiscreteApi([&#39;message&#39;])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">// 生成state</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">let state: string = generateCodeVerifier()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">// 获取地址栏授权码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">const code = getQueryString(&#39;code&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">if (code) </span><span style="--shiki-light:#24292E;--shiki-dark:#F47067;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  // 从缓存中获取 codeVerifier</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  const state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">getItem</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;state&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  // 校验state，防止cors</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  const urlState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> getQueryString</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;state&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (urlState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> state) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    message.warning(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;state校验失败.&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  } else {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    // 从缓存中获取 codeVerifier</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    getToken({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      grant_type: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;authorization_code&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      client_id: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">VITE_OAUTH_CLIENT_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      client_secret: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">VITE_OAUTH_CLIENT_SECRET</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      redirect_uri: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">VITE_OAUTH_REDIRECT_URI</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      code,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      state</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;accessToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(res))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">({ path: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        message.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">warning</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">`请求token失败：${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">e</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> e</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> e</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">statusText</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F47067;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">} else </span><span style="--shiki-light:#24292E;--shiki-dark:#F47067;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  // 缓存state</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;state&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, state)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  window.location.href </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> `${</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">meta</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">env</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">VITE_OAUTH_ISSUER</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}/oauth2/authorize?client_id=${</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">meta</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">env</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">VITE_OAUTH_CLIENT_ID</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  }&amp;response_type=code&amp;scope=openid%20profile%20message.read%20message.write&amp;redirect_uri=${</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">meta</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">env</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">VITE_OAUTH_REDIRECT_URI</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  }&amp;state=${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F47067;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;加载中...&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span></code></pre></div><h2 id="添加路由" tabindex="-1">添加路由 <a class="header-anchor" href="#添加路由" aria-label="Permalink to &quot;添加路由&quot;">​</a></h2><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    path</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;/OAuth2Redirect&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;OAuth2Redirect&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    component</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;../views/login/OAuthRedirect.vue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h1 id="认证服务修改内容" tabindex="-1">认证服务修改内容 <a class="header-anchor" href="#认证服务修改内容" aria-label="Permalink to &quot;认证服务修改内容&quot;">​</a></h1><!----><h2 id="在数据库中添加对应客户端的回调地址" tabindex="-1">在数据库中添加对应客户端的回调地址 <a class="header-anchor" href="#在数据库中添加对应客户端的回调地址" aria-label="Permalink to &quot;在数据库中添加对应客户端的回调地址&quot;">​</a></h2><p><strong>重要：例如文中的就需要给客户端<code>messaging-client</code>添加一个回调地址<code>http://127.0.0.1:5173/OAuth2Redirect</code></strong><strong>重要：例如文中的就需要给客户端<code>messaging-client</code>添加一个回调地址<code>http://127.0.0.1:5173/OAuth2Redirect</code></strong><strong>重要：例如文中的就需要给客户端<code>messaging-client</code>添加一个回调地址<code>http://127.0.0.1:5173/OAuth2Redirect</code></strong></p><p><strong>经过以上配置授权码模式的对接就完成了，接下来就可以测试了，在首页或者需要触发登录的地方添加一个按钮，点击跳转到<code>/OAuth2Redirect</code>之后会自动引导发起授权申请流程。</strong></p></div></div></main><footer class="VPDocFooter" data-v-dc58f89e data-v-b8c7433f><!--[--><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--><!--]--><div class="edit-info" data-v-b8c7433f><div class="edit-link" data-v-b8c7433f><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/Charles7c/charles7c.github.io/edit/main/docs/authorization-server/04-进阶教程/04-vue-integration-server-provider-with-authorization-code.md" target="_blank" rel="noreferrer" data-v-b8c7433f><!--[--><span class="vpi-square-pen edit-link-icon" data-v-b8c7433f></span> 不妥之处，敬请雅正<!--]--></a></div><!----></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-b8c7433f><span class="visually-hidden" id="doc-footer-aria-label" data-v-b8c7433f>Pager</span><div class="pager" data-v-b8c7433f><!----></div><div class="pager" data-v-b8c7433f><a class="VPLink link pager-link next" href="/authorization-server/01-%E5%9F%BA%E7%A1%80%E9%9B%86%E6%88%90/01-what-is-Spring-OAuth2-Authorization-Server" data-v-b8c7433f><!--[--><span class="desc" data-v-b8c7433f>下一篇</span><span class="title" data-v-b8c7433f><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>什么是Spring OAuth2 Authorization Server</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"about_index.md\":\"CrrNnRv0\",\"about_me.md\":\"BiEL_bzB\",\"authorization-server_01-基础集成_01-what-is-spring-oauth2-authorization-server.md\":\"CEyP7AxT\",\"authorization-server_04-进阶教程_01-custom-token-payload.md\":\"CJw0dGLV\",\"authorization-server_index.md\":\"Dp-6TR3D\",\"index.md\":\"C4D6vr7d\",\"archives.md\":\"Bk-WBTDQ\",\"authorization-server_04-进阶教程_06-gateway-integration-server-provider.md\":\"BZmtwjQm\",\"authorization-server_02-优化篇_01-add-redis-support-common-result.md\":\"BFtVPkmb\",\"authorization-server_03-自定义grant type_02-custom-grant-type-sms-captcha-get-access-token.md\":\"B1mSbcC9\",\"authorization-server_04-进阶教程_02-oauth2-client-integration-server-provider.md\":\"CP3B0zod\",\"authorization-server_04-进阶教程_05-vue-integration-server-provider-with-pkce.md\":\"CxlyZm6o\",\"authorization-server_01-基础集成_06-faq.md\":\"CCjTIxlM\",\"authorization-server_04-进阶教程_04-vue-integration-server-provider-with-authorization-code.md\":\"D9Z3k2fA\",\"authorization-server_01-基础集成_02-spring-boot-sample-integration.md\":\"Bjrzi_bB\",\"authorization-server_03-自定义grant type_01-device-code-flow.md\":\"CbKCOF3H\",\"authorization-server_01-基础集成_03-custom-exception-catch.md\":\"QdjjwJcb\",\"authorization-server_01-基础集成_04-login-add-captcha.md\":\"fKaVydyR\",\"authorization-server_01-基础集成_05-login-add-sms-login-type.md\":\"DfTYB5jq\",\"authorization-server_04-进阶教程_03-resource-server-integration-server-provider.md\":\"i_vQd7Ct\",\"authorization-server_04-进阶教程_10-qr-code-login.md\":\"Ba_bZpjn\",\"authorization-server_02-优化篇_02-custom-userdetailsservice.md\":\"htU18ZJz\",\"authorization-server_04-进阶教程_07-split-login-page.md\":\"DTxfn0gm\",\"authorization-server_02-优化篇_03-add-jackson-mixin.md\":\"42dt8lo3\",\"authorization-server_05-联合身份认证_01-github-gitee-federation.md\":\"DXt5bGn5\",\"authorization-server_04-进阶教程_09-implement-core-services-with-redis.md\":\"1yOiJonK\",\"authorization-server_04-进阶教程_08-split-consent-device-validation-page.md\":\"CyZyv8OT\",\"authorization-server_05-联合身份认证_02-wechat-federation.md\":\"D6oTdGoH\",\"tags.md\":\"DIJPTehm\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"云逸的知识库\",\"description\":\"个人技术知识库，记录和分享个人碎片化、结构化、体系化的技术知识内容\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Spring OAuth2 Authorization Server\",\"link\":\"/authorization-server/01-基础集成/01-what-is-Spring-OAuth2-Authorization-Server\"},{\"text\":\"我的标签\",\"link\":\"/tags\",\"activeMatch\":\"/tags\"},{\"text\":\"我的归档\",\"link\":\"/archives\",\"activeMatch\":\"/archives\"}],\"sidebar\":{\"/authorization-server/\":[{\"text\":\"基础集成 (6篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>什么是Spring OAuth2 Authorization Server\",\"link\":\"/authorization-server//01-基础集成/01-what-is-Spring-OAuth2-Authorization-Server\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>简单集成\",\"link\":\"/authorization-server//01-基础集成/02-Spring-Boot-sample-integration\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>自定义异常响应处理\",\"link\":\"/authorization-server//01-基础集成/03-custom-exception-catch\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>登录页面添加图片验证码\",\"link\":\"/authorization-server//01-基础集成/04-login-add-captcha\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>扩展登录-添加短信登录\",\"link\":\"/authorization-server//01-基础集成/05-login-add-sms-login-type\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">6</div>常见问题解答(FAQ)\",\"link\":\"/authorization-server//01-基础集成/06-FAQ\"}],\"collapsed\":false},{\"text\":\"优化篇 (3篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>添加redis支持和统一响应处理\",\"link\":\"/authorization-server//02-优化篇/01-add-redis-support-common-result\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>自定义UserDetails实现从数据库获取用户信息\",\"link\":\"/authorization-server//02-优化篇/02-custom-UserDetailsService\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>添加Jackson Mixin解决redis序列化失败问题\",\"link\":\"/authorization-server//02-优化篇/03-add-Jackson-Mixin\"}],\"collapsed\":false},{\"text\":\"自定义grant type (2篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>集成设备码授权\",\"link\":\"/authorization-server//03-自定义grant type/01-device-code-flow\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>扩展grant type(短信登录)\",\"link\":\"/authorization-server//03-自定义grant type/02-custom-grant-type-sms-captcha-get-access-token\"}],\"collapsed\":false},{\"text\":\"进阶教程 (10篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>扩展grant type(短信登录)\",\"link\":\"/authorization-server//04-进阶教程/01-custom-token-payload\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>OAuth2客户端对接认证服务\",\"link\":\"/authorization-server//04-进阶教程/02-oauth2-client-integration-server-provider\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>资源服务对接认证服务\",\"link\":\"/authorization-server//04-进阶教程/03-resource-server-integration-server-provider\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>Vue通过授权码对接认证服务\",\"link\":\"/authorization-server//04-进阶教程/04-vue-integration-server-provider-with-authorization-code\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>Vue通过PKCE对接认证服务\",\"link\":\"/authorization-server//04-进阶教程/05-vue-integration-server-provider-with-pkce\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">6</div>网关对接认证服务\",\"link\":\"/authorization-server//04-进阶教程/06-gateway-integration-server-provider\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">7</div>前后端分离-登录页面\",\"link\":\"/authorization-server//04-进阶教程/07-split-login-page\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">8</div>前后端分离-授权确认和设备码\",\"link\":\"/authorization-server//04-进阶教程/08-split-consent-device-validation-page\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">9</div>基于redis的核心服务实现\",\"link\":\"/authorization-server//04-进阶教程/09-implement-core-services-with-redis\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">10</div>扫码登录实现\",\"link\":\"/authorization-server//04-进阶教程/10-qr-code-login\"}],\"collapsed\":true},{\"text\":\"联合身份认证 (2篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>联合身份认证-gitee、github\",\"link\":\"/authorization-server//05-联合身份认证/01-github-gitee-federation\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>联合身份认证-微信登录\",\"link\":\"/authorization-server//05-联合身份认证/02-wechat-federation\"}],\"collapsed\":true}]},\"logo\":\"/logo.png\",\"outline\":{\"level\":[1,6],\"label\":\"目录\"},\"darkModeSwitchLabel\":\"切换日光/暗黑模式\",\"sidebarMenuLabel\":\"文章\",\"returnToTopLabel\":\"返回顶部\",\"lastUpdatedText\":\"最后更新\",\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"editLink\":{\"pattern\":\"https://github.com/Charles7c/charles7c.github.io/edit/main/docs/:path\",\"text\":\"不妥之处，敬请雅正\"},\"search\":{\"provider\":\"local\",\"options\":{\"locales\":{\"root\":{\"translations\":{\"button\":{\"buttonText\":\"搜索文档\",\"buttonAriaLabel\":\"搜索文档\"},\"modal\":{\"noResultsText\":\"无法找到相关结果\",\"resetButtonTitle\":\"清除查询条件\",\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\"}}}}}}},\"socialLinks\":[],\"articleMetadataConfig\":{\"author\":\"vains\",\"authorLink\":\"/about/me\",\"showViewCount\":false},\"copyrightConfig\":{\"license\":\"署名-相同方式共享 4.0 国际 (CC BY-SA 4.0)\",\"licenseLink\":\"http://creativecommons.org/licenses/by-sa/4.0/\"},\"commentConfig\":{\"type\":\"gitalk\",\"showComment\":true},\"footerConfig\":{\"showFooter\":false,\"icpRecordCode\":\"津ICP备2022005864号-2\",\"publicSecurityRecordCode\":\"津公网安备12011202000677号\",\"copyright\":\"Copyright © 2019-2024 Charles7c\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>